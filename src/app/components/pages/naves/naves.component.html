<section>
  <mat-icon aria-hidden="true" fontIcon="rocket_launch"></mat-icon>
  <h1>Naves Estelares</h1>
</section>

<form>
  <mat-form-field   color="warn">
    <mat-label>Qual nave está procurando?</mat-label>
    <input matInput type="search" [(ngModel)]="termoBusca" name="termoBusca" (keyup)="exibirNaves()">
  </mat-form-field>
</form>

@if(exibirSpinner) {
  <mat-spinner color="accent"></mat-spinner>
}

@if(!exibirSpinner) {
  <table mat-table [dataSource]="navesAPI.results" multiTemplateDataRows class="mat-elevation-z8">
    @for(coluna of colunas; track coluna) {
      <ng-container matColumnDef="{{coluna}}">
        <th mat-header-cell *matHeaderCellDef>{{coluna}}</th>
        <td mat-cell *matCellDef="let nave">{{nave[coluna]}}</td>
      </ng-container>
    }

    <ng-container matColumnDef="expandir">
      <th mat-header-cell *matHeaderCellDef>&nbsp;</th>
      <td mat-cell *matCellDef="let nave">
        <button mat-icon-button (click)="(naveCompleta = naveCompleta === nave ? null : nave); $event.stopPropagation()">
          @if(naveCompleta === nave) {
            <mat-icon>keyboard_arrow_up</mat-icon>
          } @else {
            <mat-icon>keyboard_arrow_down</mat-icon>
          }
        </button>
      </td>
    </ng-container>

    <ng-container matColumnDef="detalhesNave">
      <td mat-cell *matCellDef="let nave" [attr.colspan]="colunasCompletas.length">
        <div [@detailExpand]="nave == naveCompleta ? 'expanded' : 'collapsed'" class="example-element-detail">
          <div>Custo - {{nave.cost_in_credits}}</div>
          <div>Comprimento - {{nave.length}}</div>
          <div>Velocidade - {{nave.max_atmosphering_speed}}</div>
          <div>Tripulação - {{nave.crew}}</div>
          <div>Passageiros - {{nave.passengers}}</div>
          <div>Capacidade de carga - {{nave.cargo_capacity}}</div>
          <div>Consumíveis - {{nave.consumables}}</div>
          <div>Classificação de Hyperdrive {{nave.hyperdrive_rating}}</div>
          <div>MGLT - {{nave.MGLT}}</div>
          <div>Classe da Nave - {{nave.starship_class}}</div>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="colunasCompletas"></tr>
    <tr mat-row *matRowDef="let nave; columns: colunasCompletas;"
      class="example-element-row"
      [class.example-element-row]="naveCompleta === nave"
      (click)="naveCompleta = naveCompleta === nave ? null : nave"></tr>
    <tr mat-row *matRowDef="let row; columns: ['detalhesNave']" class="example-detail-row"></tr>

    <!-- 
    <ng-container matColumnDef="nome">
      <th mat-header-cell *matHeaderCellDef>Nome</th>
      <td mat-cell *matCellDef="let naves">{{naves.name}}</td>
    </ng-container>
    
    <ng-container matColumnDef="modelo">
      <th mat-header-cell *matHeaderCellDef>Modelo</th>
      <td mat-cell *matCellDef="let naves">{{naves.model}}</td>
    </ng-container>

    <ng-container matColumnDef="fabricante">
      <th mat-header-cell *matHeaderCellDef>Fabricante</th>
      <td mat-cell *matCellDef="let naves">{{naves.manufacturer}}</td>
    </ng-container>
    <ng-container matColumnDef="custo">
      <th mat-header-cell *matHeaderCellDef>Custo</th>
      <td mat-cell *matCellDef="let naves">{{naves.cost_in_credits}}</td>
    </ng-container>

    <ng-container matColumnDef="comprimento">
      <th mat-header-cell *matHeaderCellDef>Comprimento</th>
      <td mat-cell *matCellDef="let naves">{{naves.length}}</td>
    </ng-container> 

    <ng-container matColumnDef="velocidade">
      <th mat-header-cell *matHeaderCellDef>Velocidade Máxima</th>
      <td mat-cell *matCellDef="let naves">{{naves.max_atmosphering_speed}}</td>
    </ng-container>

    <ng-container matColumnDef="tripulacao">
      <th mat-header-cell *matHeaderCellDef>Tripulação</th>
      <td mat-cell *matCellDef="let naves">{{naves.crew}}</td>
    </ng-container>

    <ng-container matColumnDef="passageiros">
      <th mat-header-cell *matHeaderCellDef>Passageiros</th>
      <td mat-cell *matCellDef="let naves">{{naves.passengers}}</td>
    </ng-container>

    <ng-container matColumnDef="capacidade">
      <th mat-header-cell *matHeaderCellDef>Capacidade de carga</th>
      <td mat-cell *matCellDef="let naves">{{naves.cargo_capacity}}</td>
    </ng-container>

    <ng-container matColumnDef="consumiveis">
      <th mat-header-cell *matHeaderCellDef>Consumíveis</th>
      <td mat-cell *matCellDef="let naves">{{naves.consumables}}</td>
    </ng-container>

    <ng-container matColumnDef="classificacao_hiperdrive">
      <th mat-header-cell *matHeaderCellDef>Classificação de Hiperdrive</th>
      <td mat-cell *matCellDef="let naves">{{naves.hyperdrive_rating}}</td>
    </ng-container>

    <ng-container matColumnDef="MGLT">
      <th mat-header-cell *matHeaderCellDef>MGLT</th>
      <td mat-cell *matCellDef="let naves">{{naves.MGLT}}</td>
    </ng-container>

    <ng-container matColumnDef="classe_nave">
      <th mat-header-cell *matHeaderCellDef>Classe da Nave Estelar</th>
      <td mat-cell *matCellDef="let naves">{{naves.starship_class}}</td>
    </ng-container>

    <ng-container matColumnDef="pilotos">
      <th mat-header-cell *matHeaderCellDef>Pilotos</th>
      <td mat-cell *matCellDef="let naves">{{naves.pilots}}</td>
    </ng-container>

    <ng-container matColumnDef="filmes">
      <th mat-header-cell *matHeaderCellDef>Filmes</th>
      <td mat-cell *matCellDef="let naves">{{naves.films}}</td>
    </ng-container>
    <tr mat-header-row *matHeaderRowDef="colunas, track coluna"></tr>
    <tr mat-row *matRowDef="let row; columns: colunas, track coluna;"></tr>
    -->
  </table>

  <mat-paginator 
    (page)="mudarPagina($event)"
    [length]="totalDeNaves"
    [pageSize]="10"
    [pageIndex]="paginaIndex"
    showFirstLastButtons>
  </mat-paginator>
}